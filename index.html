<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FreeFlix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap");

      :root {
        --accent: #c8c8c8;
        --accent-glow: rgba(200,200,200,0.12);
        --bg: #080808;
        --surface: #111;
        --surface2: #161616;
        --surface3: #1e1e1e;
        --border: rgba(255,255,255,0.07);
        --border-accent: rgba(255,255,255,0.18);
        --text: #efefef;
        --text-dim: #888;
        --text-muted: #3a3a3a;
        --gold: #f5c518;
        --grid-cols: 6;
      }

      *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
      html { scroll-behavior: smooth; }

      body {
        font-family: 'DM Sans', sans-serif;
        background: var(--bg);
        color: var(--text);
        overflow-x: hidden;
        min-height: 100vh;
      }

      /* subtle noise grain overlay */
      body::before {
        content: '';
        position: fixed; inset: 0; z-index: 0; pointer-events: none;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
        opacity: 0.35;
      }

      ::-webkit-scrollbar { width: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 99px; }

      /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
      #header {
        position: fixed; top: 0; left: 0; right: 0; z-index: 50;
        background: rgba(8,8,8,0.94);
        backdrop-filter: blur(28px) saturate(160%);
        -webkit-backdrop-filter: blur(28px) saturate(160%);
        border-bottom: 1px solid var(--border);
      }

      .header-inner {
        max-width: 1440px; margin: 0 auto;
        padding: 13px 24px;
        display: flex; flex-direction: column; gap: 10px;
      }

      .header-top {
        display: flex; align-items: center; gap: 14px;
      }

      .logo {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.7rem;
        letter-spacing: 5px;
        line-height: 1;
        user-select: none;
        cursor: pointer;
        flex-shrink: 0;
        transition: opacity 0.15s;
      }
      .logo:hover { opacity: 0.75; }
      .logo-dim { color: rgba(255,255,255,0.35); }
      .logo-white { color: #fff; }

      /* Search bar ‚Äî shorter, centered */
      .search-wrap {
        position: relative;
        flex: 0 1 340px;
        margin-left: auto;
      }
      .search-input {
        width: 100%;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px 36px 8px 12px;
        color: var(--text);
        font-family: 'DM Sans', sans-serif;
        font-size: 0.83rem;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      }
      .search-input::placeholder { color: var(--text-muted); }
      .search-input:focus {
        border-color: var(--border-accent);
        box-shadow: 0 0 0 3px rgba(255,255,255,0.04);
        background: var(--surface3);
      }
      .search-icon {
        position: absolute; right: 10px; top: 50%;
        transform: translateY(-50%);
        color: rgba(255,255,255,0.22); pointer-events: none;
      }

      /* Search result count */
      .search-count {
        font-size: 0.68rem; font-weight: 500;
        color: var(--text-muted);
        white-space: nowrap; flex-shrink: 0;
        transition: opacity 0.2s;
      }

      .header-actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }

      /* Roulette + Settings buttons */
      .icon-btn {
        width: 32px; height: 32px;
        border-radius: 8px;
        background: var(--surface2);
        border: 1px solid var(--border);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--text-dim);
        transition: all 0.15s ease;
        flex-shrink: 0;
      }
      .icon-btn:hover { border-color: var(--border-accent); color: var(--text); background: var(--surface3); }
      .icon-btn.active { background: #fff; border-color: #fff; color: #000; }

      /* Roulette button ‚Äî slightly wider */
      .roulette-btn {
        padding: 0 12px; width: auto; gap: 6px; font-size: 0.72rem; font-weight: 600;
        letter-spacing: 0.4px;
        border-radius: 8px;
        background: var(--surface2);
        border: 1px solid var(--border);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--text-dim);
        height: 32px;
        white-space: nowrap;
        transition: all 0.15s ease;
      }
      .roulette-btn:hover { border-color: var(--border-accent); color: var(--text); background: var(--surface3); }

      /* Filter bar */
      .filter-bar {
        display: flex; gap: 4px;
        overflow-x: auto; padding-bottom: 1px;
        scrollbar-width: none;
        align-items: center;
      }
      .filter-bar::-webkit-scrollbar { display: none; }

      .fsep {
        width: 1px; flex-shrink: 0; margin: 0 4px;
        background: rgba(255,255,255,0.07);
        align-self: stretch;
      }

      .fbtn {
        flex-shrink: 0;
        padding: 4px 12px;
        border-radius: 6px;
        font-family: 'DM Sans', sans-serif;
        font-size: 0.72rem; font-weight: 600;
        border: 1px solid var(--border);
        background: var(--surface2);
        color: var(--text-dim);
        cursor: pointer;
        transition: all 0.15s ease;
        white-space: nowrap;
      }
      .fbtn:hover { border-color: var(--border-accent); color: var(--text); background: var(--surface3); }
      .fbtn.on { background: #fff; border-color: #fff; color: #000; }

      /* Sort label */
      .sort-label {
        font-size: 0.68rem; font-weight: 500;
        color: var(--text-muted); margin-left: auto; flex-shrink: 0;
        display: flex; align-items: center; gap: 6px;
      }
      .sort-select {
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 6px;
        color: var(--text-dim);
        font-family: 'DM Sans', sans-serif;
        font-size: 0.72rem;
        padding: 3px 8px;
        outline: none;
        cursor: pointer;
        transition: all 0.15s;
      }
      .sort-select:hover, .sort-select:focus { border-color: var(--border-accent); color: var(--text); }

      /* ‚îÄ‚îÄ‚îÄ SETTINGS PANEL ‚îÄ‚îÄ‚îÄ */
      .settings-panel {
        position: fixed; top: 0; right: 0; bottom: 0; z-index: 300;
        width: 300px;
        background: var(--surface);
        border-left: 1px solid var(--border);
        backdrop-filter: blur(20px);
        padding: 24px 20px;
        display: flex; flex-direction: column; gap: 0;
        animation: slideInRight 0.25s cubic-bezier(0.25,0.46,0.45,0.94);
        overflow-y: auto;
      }
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to   { transform: translateX(0);   opacity: 1; }
      }

      .settings-overlay {
        position: fixed; inset: 0; z-index: 299;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
        animation: mfade 0.2s ease;
      }

      .settings-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.2rem; letter-spacing: 3px;
        color: var(--text); margin-bottom: 24px;
        display: flex; justify-content: space-between; align-items: center;
      }

      .settings-close {
        width: 28px; height: 28px; border-radius: 6px;
        background: var(--surface2); border: 1px solid var(--border);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--text-dim); font-size: 0.75rem;
        transition: all 0.15s;
      }
      .settings-close:hover { background: var(--surface3); color: var(--text); }

      .settings-section { margin-bottom: 28px; }
      .settings-section-title {
        font-size: 0.6rem; font-weight: 700;
        text-transform: uppercase; letter-spacing: 2.5px;
        color: var(--text-muted);
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border);
      }

      .settings-row {
        display: flex; align-items: center; justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255,255,255,0.03);
      }
      .settings-row-label { font-size: 0.82rem; font-weight: 500; color: var(--text-dim); }
      .settings-row-sub { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }

      /* Toggle */
      .toggle {
        width: 36px; height: 20px; border-radius: 99px;
        background: var(--surface3); border: 1px solid var(--border);
        position: relative; cursor: pointer; transition: background 0.2s;
        flex-shrink: 0;
      }
      .toggle.on { background: #fff; border-color: #fff; }
      .toggle::after {
        content: '';
        position: absolute; top: 2px; left: 2px;
        width: 14px; height: 14px; border-radius: 50%;
        background: var(--text-muted);
        transition: transform 0.2s, background 0.2s;
      }
      .toggle.on::after { transform: translateX(16px); background: #000; }

      /* Grid size slider */
      .grid-slider {
        -webkit-appearance: none;
        width: 100%; height: 3px;
        background: var(--surface3);
        border-radius: 99px; outline: none; cursor: pointer;
        margin-top: 12px;
      }
      .grid-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px; height: 16px; border-radius: 50%;
        background: #fff; cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      }

      .region-select {
        width: 100%;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 7px;
        color: var(--text-dim);
        font-family: 'DM Sans', sans-serif;
        font-size: 0.8rem;
        padding: 8px 10px;
        outline: none; cursor: pointer;
        margin-top: 10px;
        transition: all 0.15s;
      }
      .region-select:hover, .region-select:focus { border-color: var(--border-accent); color: var(--text); }

      /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
      #main {
        position: relative; z-index: 1;
        max-width: 1440px; margin: 0 auto;
        padding: 0 20px 100px;
      }

      /* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
      .grid {
        display: grid;
        grid-template-columns: repeat(var(--grid-cols, 2), 1fr);
        gap: 8px;
      }
      @media (min-width: 480px)  { :root { --grid-cols: 3; } }
      @media (min-width: 720px)  { :root { --grid-cols: 4; } }
      @media (min-width: 980px)  { :root { --grid-cols: 5; } }
      @media (min-width: 1220px) { :root { --grid-cols: 6; } }
      @media (min-width: 1440px) { :root { --grid-cols: 7; } }

      /* ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ */
      .card {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        aspect-ratio: 2/3;
        background: var(--surface2);
        animation: cardIn 0.38s ease both;
        isolation: isolate;
        transition: transform 0.28s cubic-bezier(0.25,0.46,0.45,0.94), box-shadow 0.28s;
      }
      @keyframes cardIn {
        from { opacity: 0; transform: translateY(16px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      .card::after {
        content: '';
        position: absolute; inset: 0;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0);
        transition: border-color 0.25s;
        pointer-events: none;
        z-index: 3;
      }
      .card:hover::after { border-color: rgba(255,255,255,0.22); }
      .card:hover { box-shadow: 0 20px 60px rgba(0,0,0,0.7); transform: translateY(-4px) scale(1.035); }

      .card-img {
        width: 100%; height: 100%;
        object-fit: cover; display: block;
        transition: transform 0.4s ease;
      }
      .card:hover .card-img { transform: scale(1.06); }

      /* placeholder for broken images */
      .card-img-placeholder {
        width: 100%; height: 100%;
        display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        background: var(--surface3);
        gap: 8px;
        color: var(--text-muted);
        font-size: 0.7rem; font-weight: 600;
        text-align: center; padding: 16px;
      }
      .card-img-placeholder svg { opacity: 0.3; }

      .card-grad {
        position: absolute; inset: 0; z-index: 1;
        background: linear-gradient(to top,
          rgba(0,0,0,0.96) 0%,
          rgba(0,0,0,0.5) 38%,
          transparent 65%
        );
        opacity: 0; transition: opacity 0.25s ease;
      }
      .card:hover .card-grad { opacity: 1; }

      .card-info {
        position: absolute; bottom: 0; left: 0; right: 0; z-index: 2;
        padding: 12px 10px 10px;
        transform: translateY(6px);
        opacity: 0; transition: all 0.25s ease;
      }
      .card:hover .card-info { opacity: 1; transform: translateY(0); }

      .card-name {
        font-size: 0.75rem; font-weight: 700; color: #fff;
        line-height: 1.25; margin-bottom: 6px;
        display: -webkit-box;
        -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
      }

      .card-badges { display: flex; gap: 4px; flex-wrap: wrap; align-items: center; }

      .cbadge {
        font-size: 0.58rem; font-weight: 700;
        text-transform: uppercase; letter-spacing: 0.6px;
        padding: 2px 6px; border-radius: 3px;
      }
      .cbadge-type { background: rgba(255,255,255,0.15); color: #fff; }
      .cbadge-rating { background: rgba(245,197,24,0.15); color: var(--gold); border: 1px solid rgba(245,197,24,0.2); }

      /* play icon center */
      .card-play {
        position: absolute; top: 50%; left: 50%; z-index: 2;
        transform: translate(-50%, -50%) scale(0.6);
        width: 44px; height: 44px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        opacity: 0;
        transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255,255,255,0.25);
      }
      .card:hover .card-play { opacity: 1; transform: translate(-50%, -50%) scale(1); }

      /* source count badge top-right */
      .card-src-count {
        position: absolute; top: 8px; right: 8px; z-index: 2;
        font-size: 0.6rem; font-weight: 700;
        background: rgba(0,0,0,0.7); color: var(--text-dim);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 2px 7px; border-radius: 99px;
        backdrop-filter: blur(6px);
        opacity: 0; transition: opacity 0.2s;
      }
      .card:hover .card-src-count { opacity: 1; }

      /* ‚îÄ‚îÄ‚îÄ SKELETON ‚îÄ‚îÄ‚îÄ */
      .skel {
        aspect-ratio: 2/3; border-radius: 10px;
        background: linear-gradient(100deg, #0d0d0d 0%, #1c1c1c 50%, #0d0d0d 100%);
        background-size: 300% 100%;
        animation: skel 1.8s ease infinite;
      }
      @keyframes skel {
        0% { background-position: 100% 50%; }
        100% { background-position: -100% 50%; }
      }

      /* ‚îÄ‚îÄ‚îÄ EMPTY / ERROR ‚îÄ‚îÄ‚îÄ */
      .state-box {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 80px 20px; gap: 12px; color: var(--text-muted);
        text-align: center;
      }
      .state-icon { font-size: 3rem; }
      .state-title { font-size: 1rem; font-weight: 600; color: var(--text-dim); }
      .state-sub { font-size: 0.825rem; }

      .err-box {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.09);
        border-radius: 10px; padding: 16px 18px;
        color: #aaa; font-size: 0.85rem; font-weight: 500;
        display: flex; align-items: center; gap: 10px;
      }

      /* ‚îÄ‚îÄ‚îÄ LOADERS ‚îÄ‚îÄ‚îÄ */
      .load-row { display: flex; justify-content: center; padding: 24px 0; }
      .spin {
        width: 20px; height: 20px;
        border: 2px solid rgba(255,255,255,0.08);
        border-top-color: rgba(255,255,255,0.4);
        border-radius: 50%;
        animation: spin 0.65s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      .end-line {
        display: flex; align-items: center; gap: 14px;
        padding: 28px 0;
        color: var(--text-muted); font-size: 0.78rem; font-weight: 500;
      }
      .end-line::before, .end-line::after {
        content: ''; flex: 1; height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
      }

      /* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
      .mbg {
        position: fixed; inset: 0; z-index: 200;
        background: rgba(0,0,0,0.88);
        backdrop-filter: blur(24px) saturate(140%);
        -webkit-backdrop-filter: blur(24px) saturate(140%);
        display: flex; align-items: center; justify-content: center;
        padding: 16px;
        animation: mfade 0.2s ease;
      }
      @keyframes mfade { from { opacity: 0; } to { opacity: 1; } }

      .mbox {
        background: var(--surface);
        border: 1px solid rgba(255,255,255,0.06);
        border-radius: 20px;
        width: 100%; max-width: 660px; max-height: 90vh;
        overflow-y: auto; position: relative;
        animation: mslide 0.3s cubic-bezier(0.25,0.46,0.45,0.94);
        scrollbar-width: none;
        box-shadow: 0 40px 80px rgba(0,0,0,0.7);
      }
      .mbox::-webkit-scrollbar { display: none; }
      @keyframes mslide {
        from { opacity: 0; transform: translateY(32px) scale(0.96); }
        to   { opacity: 1; transform: translateY(0) scale(1); }
      }

      /* 16:9 backdrop hero */
      .mhero {
        position: relative;
        aspect-ratio: 16/9;
        border-radius: 20px 20px 0 0; overflow: hidden;
        background: var(--surface2);
      }
      .mhero img { width: 100%; height: 100%; object-fit: cover; display: block; }
      .mhero-grad {
        position: absolute; inset: 0;
        background: linear-gradient(to top, var(--surface) 0%, rgba(17,17,17,0.05) 55%, transparent 100%);
      }

      .mclose {
        position: absolute; top: 12px; right: 12px; z-index: 10;
        width: 32px; height: 32px;
        background: rgba(0,0,0,0.65);
        border: 1px solid rgba(255,255,255,0.12);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--text-dim); font-size: 0.85rem;
        transition: all 0.15s;
      }
      .mclose:hover { color: #fff; background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.25); }

      .mbody { padding: 4px 22px 26px; }

      .mtitle {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem; letter-spacing: 2px; color: #fff;
        line-height: 1; margin-bottom: 10px;
      }

      .mtags { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }

      .mtag { padding: 4px 10px; border-radius: 5px; font-size: 0.68rem; font-weight: 600; }
      .mtag-type { background: rgba(255,255,255,0.1); color: #ddd; }
      .mtag-rating { background: rgba(245,197,24,0.1); color: var(--gold); border: 1px solid rgba(245,197,24,0.15); }
      .mtag-year { background: rgba(255,255,255,0.05); color: var(--text-dim); border: 1px solid var(--border); }

      /* Overview / description */
      .moverview {
        font-size: 0.84rem; font-weight: 400; color: var(--text-dim);
        line-height: 1.65;
        margin-bottom: 20px;
        font-style: italic;
      }

      /* Additional meta row */
      .mmeta {
        display: flex; gap: 16px; flex-wrap: wrap;
        margin-bottom: 20px;
      }
      .mmeta-item {
        display: flex; flex-direction: column; gap: 2px;
      }
      .mmeta-key {
        font-size: 0.58rem; font-weight: 700;
        text-transform: uppercase; letter-spacing: 2px;
        color: var(--text-muted);
      }
      .mmeta-val { font-size: 0.8rem; font-weight: 600; color: var(--text); }

      .msec { margin-bottom: 16px; }

      .msec-label {
        font-size: 0.6rem; font-weight: 700;
        text-transform: uppercase; letter-spacing: 2px;
        color: var(--text-muted);
        display: flex; align-items: center; gap: 8px;
        margin-bottom: 8px;
      }
      .msec-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

      .prow {
        display: flex; align-items: center; justify-content: space-between;
        padding: 10px 12px; border-radius: 9px;
        background: var(--surface2);
        border: 1px solid var(--border);
        margin-bottom: 6px;
        text-decoration: none;
        transition: all 0.15s ease;
      }
      .prow:hover { border-color: var(--border-accent); background: rgba(255,255,255,0.03); transform: translateX(3px); }
      .prow:last-child { margin-bottom: 0; }

      .pleft { display: flex; align-items: center; gap: 10px; }
      .pimg {
        width: 32px; height: 32px; border-radius: 6px;
        object-fit: cover; flex-shrink: 0;
        background: var(--surface3); border: 1px solid var(--border);
      }
      .pname { font-weight: 600; font-size: 0.85rem; color: var(--text); }

      .pwatch {
        font-size: 0.72rem; font-weight: 700;
        color: rgba(255,255,255,0.5);
        display: flex; align-items: center; gap: 4px;
        transition: gap 0.15s, color 0.15s;
        white-space: nowrap;
      }
      .prow:hover .pwatch { gap: 7px; color: #fff; }

      .no-src { text-align: center; padding: 24px; color: var(--text-muted); font-size: 0.85rem; }

      /* ‚îÄ‚îÄ‚îÄ ROULETTE OVERLAY ‚îÄ‚îÄ‚îÄ */
      .roulette-bg {
        position: fixed; inset: 0; z-index: 250;
        background: rgba(0,0,0,0.9);
        backdrop-filter: blur(32px);
        display: flex; align-items: center; justify-content: center;
        animation: mfade 0.25s ease;
      }
      .roulette-card {
        display: flex; flex-direction: column; align-items: center; gap: 20px;
        animation: roulettePop 0.4s cubic-bezier(0.34,1.56,0.64,1);
      }
      @keyframes roulettePop {
        from { transform: scale(0.7) rotate(-3deg); opacity: 0; }
        to   { transform: scale(1) rotate(0deg); opacity: 1; }
      }
      .roulette-poster {
        width: 180px; height: 270px; border-radius: 14px; overflow: hidden;
        box-shadow: 0 30px 80px rgba(0,0,0,0.8);
        border: 1px solid rgba(255,255,255,0.1);
      }
      .roulette-poster img { width: 100%; height: 100%; object-fit: cover; }
      .roulette-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2.2rem; letter-spacing: 4px; color: #fff;
        text-align: center; max-width: 360px; line-height: 1.1;
      }
      .roulette-meta { color: var(--text-dim); font-size: 0.8rem; text-align: center; }
      .roulette-actions { display: flex; gap: 10px; }
      .rbtn {
        padding: 10px 20px; border-radius: 9px; font-size: 0.8rem; font-weight: 700;
        cursor: pointer; transition: all 0.15s; border: 1px solid;
      }
      .rbtn-open { background: #fff; color: #000; border-color: #fff; }
      .rbtn-open:hover { background: rgba(255,255,255,0.85); }
      .rbtn-skip { background: transparent; color: var(--text-dim); border-color: var(--border); }
      .rbtn-skip:hover { background: var(--surface2); color: var(--text); border-color: var(--border-accent); }
      .rbtn-close { background: transparent; color: var(--text-muted); border-color: transparent; font-size: 0.72rem; }
      .rbtn-close:hover { color: var(--text-dim); }

      /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
      @media (max-width: 600px) {
        .header-inner { padding: 11px 14px; }
        #main { padding: 0 10px 80px; }
        .search-wrap { flex: 1; }
        .roulette-btn span { display: none; }
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useState, useRef, useCallback, useMemo } = React;

      /* ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ */
      const API_BASE =
        (window.ENV && window.ENV.API_URL)
          ? window.ENV.API_URL
          : 'https://freeflix-production.up.railway.app/';

      const TMDB_IMG = (path, size = 'w500') =>
        path ? `https://image.tmdb.org/t/p/${size}${path}` : null;

      /* Fallback poster via TMDB search if direct path fails */
      const TMDB_SEARCH_POSTER = (name) =>
        `https://via.placeholder.com/300x450/161616/3a3a3a?text=${encodeURIComponent((name || '').replace(/_/g,' ').slice(0,20))}`;

      const PER_PAGE = 20;

      const SECTION_DEFS = [
        { key: 'flatrate', label: 'Included with Subscription' },
        { key: 'rent',     label: 'Rent' },
        { key: 'buy',      label: 'Buy' },
        { key: 'free',     label: 'Free' },
        { key: 'other',    label: 'Other' },
      ];

      const REGIONS = [
        { code: 'all', label: 'All Regions' },
        { code: 'US', label: 'üá∫üá∏ United States' },
        { code: 'GB', label: 'üá¨üáß United Kingdom' },
        { code: 'DE', label: 'üá©üá™ Germany' },
        { code: 'FR', label: 'üá´üá∑ France' },
        { code: 'TR', label: 'üáπüá∑ Turkey' },
        { code: 'AU', label: 'üá¶üá∫ Australia' },
        { code: 'CA', label: 'üá®üá¶ Canada' },
        { code: 'IN', label: 'üáÆüá≥ India' },
        { code: 'JP', label: 'üáØüáµ Japan' },
      ];

      function dedup(arr) {
        const seen = new Set();
        return arr.filter(item => {
          const key = item.id ?? `${item.name}||${item.type}`;
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });
      }

      /* ‚îÄ‚îÄ‚îÄ IMAGE with fallback ‚îÄ‚îÄ‚îÄ */
      function PosterImg({ path, name, className, size = 'w500' }) {
        const [failed, setFailed] = useState(false);
        const src = TMDB_IMG(path, size);

        if (!src || failed) {
          return (
            <div className="card-img-placeholder">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zm-10-7l-4 5h8l-3-4-2 2.5z"/>
              </svg>
              <span>{(name||'').replace(/_/g,' ').slice(0,30)}</span>
            </div>
          );
        }
        return <img className={className} src={src} alt={name} onError={() => setFailed(true)} />;
      }

      /* ‚îÄ‚îÄ‚îÄ PROVIDER ROW ‚îÄ‚îÄ‚îÄ */
      function ProviderRow({ src }) {
        // Ensure external links open properly
        const href = src.provider_url && src.provider_url !== '#'
          ? src.provider_url
          : (src.link || null);

        return (
          <a
            href={href || '#'}
            target={href ? '_blank' : '_self'}
            rel="noopener noreferrer"
            className="prow"
            onClick={e => { if (!href) e.preventDefault(); }}
          >
            <div className="pleft">
              {src.provider_image ? (
                <img
                  src={TMDB_IMG(src.provider_image, 'w92')}
                  alt={src.provider}
                  className="pimg"
                  onError={e => { e.target.style.display = 'none'; }}
                />
              ) : (
                <div className="pimg" style={{display:'flex',alignItems:'center',justifyContent:'center',fontSize:'0.65rem',fontWeight:700,color:'var(--text-muted)'}}>
                  {(src.provider||'?').slice(0,2).toUpperCase()}
                </div>
              )}
              <span className="pname">{src.provider}</span>
            </div>
            <span className="pwatch">
              {href ? 'Watch' : 'Unavailable'}
              {href && (
                <svg width="11" height="11" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
              )}
            </span>
          </a>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
      function Modal({ item, onClose, profanityFilter }) {
        if (!item) return null;

        useEffect(() => {
          const fn = e => { if (e.key === 'Escape') onClose(); };
          document.addEventListener('keydown', fn);
          document.body.style.overflow = 'hidden';
          return () => {
            document.removeEventListener('keydown', fn);
            document.body.style.overflow = '';
          };
        }, []);

        const grouped = useMemo(() =>
          (item.source_info || []).reduce((acc, src) => {
            const k = src.payment || 'other';
            (acc[k] = acc[k] || []).push(src);
            return acc;
          }, {}),
        [item]);

        const sections = SECTION_DEFS.filter(s => grouped[s.key]?.length > 0);
        const srcCount = (item.source_info || []).length;
        const displayName = (item.name || '').replace(/_/g, ' ');

        // Prefer backdrop (16:9) for modal, fall back to poster
        const backdropPath = item.backdrop || item.backdrop_path;
        const heroSrc = backdropPath ? TMDB_IMG(backdropPath, 'w1280') : TMDB_IMG(item.image, 'w780');

        const [heroFailed, setHeroFailed] = useState(false);

        const overview = item.overview || item.description || item.synopsis || null;
        const genres = item.genres || [];
        const runtime = item.runtime;
        const seasons = item.seasons;

        return (
          <div className="mbg" onClick={onClose}>
            <div className="mbox" onClick={e => e.stopPropagation()}>

              {/* Hero ‚Äî 16:9 backdrop */}
              <div className="mhero">
                {heroSrc && !heroFailed
                  ? <img src={heroSrc} alt={displayName} onError={() => setHeroFailed(true)} />
                  : (
                    <div style={{width:'100%',height:'100%',display:'flex',alignItems:'center',justifyContent:'center',background:'var(--surface2)'}}>
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="rgba(255,255,255,0.1)">
                        <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z"/>
                      </svg>
                    </div>
                  )
                }
                <div className="mhero-grad" />
                <button className="mclose" onClick={onClose} aria-label="Close">‚úï</button>
              </div>

              {/* Body */}
              <div className="mbody">
                <h2 className="mtitle">{displayName}</h2>

                <div className="mtags">
                  <span className="mtag mtag-type">
                    {item.type === 'movie' ? 'üé¨ Movie' : 'üì∫ Series'}
                  </span>
                  {item.rating && (
                    <span className="mtag mtag-rating">‚≠ê {item.rating}/10</span>
                  )}
                  {item.year && (
                    <span className="mtag mtag-year">{item.year}</span>
                  )}
                  {srcCount > 0 && (
                    <span className="mtag" style={{background:'rgba(255,255,255,0.04)',color:'var(--text-muted)',border:'1px solid rgba(255,255,255,0.06)'}}>
                      {srcCount} source{srcCount !== 1 ? 's' : ''}
                    </span>
                  )}
                </div>

                {/* Overview */}
                {overview && (
                  <p className="moverview">
                    {profanityFilter ? overview.replace(/\b(fuck|shit|ass|bitch|damn|crap|bastard|hell)\b/gi, '***') : overview}
                  </p>
                )}

                {/* Meta info */}
                {(genres.length > 0 || runtime || seasons) && (
                  <div className="mmeta">
                    {genres.length > 0 && (
                      <div className="mmeta-item">
                        <span className="mmeta-key">Genre</span>
                        <span className="mmeta-val">{genres.slice(0,3).join(', ')}</span>
                      </div>
                    )}
                    {runtime && (
                      <div className="mmeta-item">
                        <span className="mmeta-key">Runtime</span>
                        <span className="mmeta-val">{runtime} min</span>
                      </div>
                    )}
                    {seasons && (
                      <div className="mmeta-item">
                        <span className="mmeta-key">Seasons</span>
                        <span className="mmeta-val">{seasons}</span>
                      </div>
                    )}
                  </div>
                )}

                {sections.length > 0 ? sections.map(({ key, label }) => (
                  <div key={key} className="msec">
                    <div className="msec-label">{label}</div>
                    {grouped[key].map((src, i) => <ProviderRow key={i} src={src} />)}
                  </div>
                )) : (
                  <div className="no-src">No streaming sources found for this title</div>
                )}
              </div>
            </div>
          </div>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ */
      function Card({ item, index, onClick, cardRef }) {
        const srcCount = (item.source_info || []).length;
        const [imgFailed, setImgFailed] = useState(false);
        const displayName = (item.name || '').replace(/_/g, ' ');
        const imgSrc = TMDB_IMG(item.image);

        return (
          <div
            className="card"
            ref={cardRef}
            onClick={onClick}
            style={{ animationDelay: `${(index % PER_PAGE) * 0.028}s` }}
          >
            {imgSrc && !imgFailed
              ? <img className="card-img" src={imgSrc} alt={displayName} loading="lazy" onError={() => setImgFailed(true)} />
              : (
                <div className="card-img-placeholder">
                  <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" style={{opacity:0.25}}>
                    <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zm-10-7l-4 5h8l-3-4-2 2.5z"/>
                  </svg>
                  <span style={{fontSize:'0.62rem',color:'var(--text-muted)',textAlign:'center',lineHeight:1.3,padding:'0 8px'}}>{displayName}</span>
                </div>
              )
            }
            <div className="card-grad" />

            {srcCount > 0 && (
              <div className="card-src-count">{srcCount} src</div>
            )}

            <div className="card-info">
              <div className="card-name">{displayName}</div>
              <div className="card-badges">
                <span className="cbadge cbadge-type">{item.type}</span>
                {item.rating && (
                  <span className="cbadge cbadge-rating">‚≠ê {item.rating}</span>
                )}
              </div>
            </div>

            <div className="card-play">
              <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z" />
              </svg>
            </div>
          </div>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ SKELETON ‚îÄ‚îÄ‚îÄ */
      function Skeletons({ n = PER_PAGE }) {
        return (
          <div className="grid">
            {Array.from({ length: n }).map((_, i) => <div key={i} className="skel" />)}
          </div>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ SETTINGS PANEL ‚îÄ‚îÄ‚îÄ */
      function SettingsPanel({ settings, onChange, onClose }) {
        return (
          <>
            <div className="settings-overlay" onClick={onClose} />
            <div className="settings-panel">
              <div className="settings-title">
                Settings
                <button className="settings-close" onClick={onClose}>‚úï</button>
              </div>

              <div className="settings-section">
                <div className="settings-section-title">Display</div>
                <div className="settings-row">
                  <div>
                    <div className="settings-row-label">Grid Size</div>
                    <div className="settings-row-sub">Columns per row</div>
                    <input
                      type="range" min="3" max="9"
                      value={settings.gridCols}
                      onChange={e => onChange('gridCols', Number(e.target.value))}
                      className="grid-slider"
                    />
                    <div style={{fontSize:'0.68rem',color:'var(--text-muted)',marginTop:4}}>{settings.gridCols} columns</div>
                  </div>
                </div>
              </div>

              <div className="settings-section">
                <div className="settings-section-title">Content</div>
                <div className="settings-row">
                  <div>
                    <div className="settings-row-label">Profanity Filter</div>
                    <div className="settings-row-sub">Censor strong language in descriptions</div>
                  </div>
                  <div
                    className={`toggle ${settings.profanityFilter ? 'on' : ''}`}
                    onClick={() => onChange('profanityFilter', !settings.profanityFilter)}
                  />
                </div>
              </div>

              <div className="settings-section">
                <div className="settings-section-title">Region</div>
                <div style={{fontSize:'0.78rem',color:'var(--text-muted)',lineHeight:1.5,marginBottom:4}}>
                  Filter availability by your region. Some titles may only be accessible in certain countries.
                </div>
                <select
                  className="region-select"
                  value={settings.region}
                  onChange={e => onChange('region', e.target.value)}
                >
                  {REGIONS.map(r => (
                    <option key={r.code} value={r.code}>{r.label}</option>
                  ))}
                </select>
              </div>
            </div>
          </>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ ROULETTE ‚îÄ‚îÄ‚îÄ */
      function RouletteOverlay({ items, onOpen, onClose }) {
        const [pick, setPick] = useState(() => {
          const pool = items.filter(i => i.image);
          return pool[Math.floor(Math.random() * pool.length)];
        });

        const spin = () => {
          const pool = items.filter(i => i.image);
          setPick(pool[Math.floor(Math.random() * pool.length)]);
        };

        if (!pick) {
          return (
            <div className="roulette-bg" onClick={onClose}>
              <div style={{color:'var(--text-dim)',textAlign:'center'}}>
                <div style={{fontSize:'2rem',marginBottom:12}}>üé≤</div>
                <div>Not enough titles loaded yet</div>
              </div>
            </div>
          );
        }

        const imgSrc = TMDB_IMG(pick.image, 'w342');
        const displayName = (pick.name || '').replace(/_/g,' ');

        return (
          <div className="roulette-bg" onClick={onClose}>
            <div className="roulette-card" onClick={e => e.stopPropagation()}>
              <div style={{fontSize:'0.7rem',letterSpacing:'3px',textTransform:'uppercase',color:'var(--text-muted)'}}>
                üé≤ Random Pick
              </div>
              <div className="roulette-poster">
                {imgSrc
                  ? <img src={imgSrc} alt={displayName} style={{width:'100%',height:'100%',objectFit:'cover'}} />
                  : <div style={{width:'100%',height:'100%',background:'var(--surface3)',display:'flex',alignItems:'center',justifyContent:'center',color:'var(--text-muted)',fontSize:'0.8rem',textAlign:'center',padding:16}}>{displayName}</div>
                }
              </div>
              <div className="roulette-title">{displayName}</div>
              <div className="roulette-meta">
                {pick.type === 'movie' ? 'üé¨ Movie' : 'üì∫ Series'}
                {pick.year ? ` ¬∑ ${pick.year}` : ''}
                {pick.rating ? ` ¬∑ ‚≠ê ${pick.rating}` : ''}
              </div>
              <div className="roulette-actions">
                <button className="rbtn rbtn-open" onClick={() => { onOpen(pick); onClose(); }}>Open Title</button>
                <button className="rbtn rbtn-skip" onClick={spin}>Try Another üé≤</button>
              </div>
              <button className="rbtn rbtn-close" onClick={onClose}>Close</button>
            </div>
          </div>
        );
      }

      /* ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ */
      function FreeFlix() {
        const [items, setItems]             = useState([]);
        const [selected, setSelected]       = useState(null);
        const [loading, setLoading]         = useState(true);
        const [loadingMore, setLoadingMore] = useState(false);
        const [error, setError]             = useState(null);
        const [page, setPage]               = useState(1);
        const [hasMore, setHasMore]         = useState(true);
        const [sources, setSources]         = useState([]);

        const [search, setSearch]           = useState('');
        const [debSearch, setDebSearch]     = useState('');
        const [typeFilter, setTypeFilter]   = useState('all');
        const [srcFilter, setSrcFilter]     = useState('all');
        const [sortBy, setSortBy]           = useState('popularity');

        const [showSettings, setShowSettings] = useState(false);
        const [showRoulette, setShowRoulette] = useState(false);

        const [settings, setSettings] = useState({
          profanityFilter: false,
          gridCols: null, // null = responsive
          region: 'all',
        });

        const updateSetting = (key, val) => setSettings(prev => ({ ...prev, [key]: val }));

        // Apply custom grid cols
        useEffect(() => {
          if (settings.gridCols) {
            document.documentElement.style.setProperty('--grid-cols', settings.gridCols);
          } else {
            document.documentElement.style.removeProperty('--grid-cols');
          }
        }, [settings.gridCols]);

        const headerRef = useRef();
        const [headerH, setHeaderH] = useState(120);
        useEffect(() => {
          if (!headerRef.current) return;
          const ro = new ResizeObserver(() => setHeaderH(headerRef.current.offsetHeight));
          ro.observe(headerRef.current);
          return () => ro.disconnect();
        }, []);

        const observerRef = useRef();
        const lastCardRef = useRef();

        /* Debounce search */
        useEffect(() => {
          const t = setTimeout(() => setDebSearch(search), 420);
          return () => clearTimeout(t);
        }, [search]);

        /* Fetch */
        const fetchItems = useCallback((pageNum, append, q) => {
          append ? setLoadingMore(true) : setLoading(true);
          setError(null);

          const p = new URLSearchParams({ page: pageNum, limit: PER_PAGE });
          if (q) p.set('search', q);

          fetch(`${API_BASE}?${p}`)
            .then(r => {
              if (!r.ok) throw new Error(`${r.status}`);
              return r.json();
            })
            .then(data => {
              const raw = Array.isArray(data)
                ? data
                : Array.isArray(data.content) ? data.content : [];

              const fresh = dedup(raw);

              setItems(prev => {
                const next = append ? dedup([...prev, ...fresh]) : fresh;
                return next;
              });

              if (!append) {
                const seen = new Set();
                fresh.forEach(it => (it.source_info || []).forEach(s => seen.add(s.provider)));
                setSources([...seen].filter(Boolean).sort());
              }

              setHasMore(fresh.length === PER_PAGE);
            })
            .catch(err => {
              console.error(err);
              setError('Could not reach the server ‚Äî please try again.');
            })
            .finally(() => {
              setLoading(false);
              setLoadingMore(false);
            });
        }, []);

        /* Reset on filter / search change */
        useEffect(() => {
          setPage(1);
          setItems([]);
          setHasMore(true);
          fetchItems(1, false, debSearch);
        }, [debSearch, fetchItems]);

        /* Load next page */
        const loadMore = useCallback(() => {
          if (loadingMore || !hasMore || loading) return;
          const next = page + 1;
          setPage(next);
          fetchItems(next, true, debSearch);
        }, [page, hasMore, loadingMore, loading, fetchItems, debSearch]);

        /* Infinite scroll */
        useEffect(() => {
          observerRef.current = new IntersectionObserver(
            entries => { if (entries[0].isIntersecting) loadMore(); },
            { rootMargin: '400px' }
          );
          if (lastCardRef.current) observerRef.current.observe(lastCardRef.current);
          return () => observerRef.current?.disconnect();
        }, [loadMore]);

        /* Client-side filter + sort */
        const filtered = useMemo(() => {
          let arr = items.filter(item => {
            // Type filter
            if (typeFilter !== 'all' && item.type !== typeFilter) return false;
            // Source filter
            if (srcFilter !== 'all') {
              const ps = (item.source_info || []).map(s => s.provider);
              if (!ps.includes(srcFilter)) return false;
            }
            // Region filter
            if (settings.region !== 'all' && item.regions) {
              if (!item.regions.includes(settings.region)) return false;
            }
            return true;
          });

          // Sort
          if (sortBy === 'popularity') {
            arr = [...arr].sort((a, b) => {
              const pa = a.popularity ?? a.vote_count ?? 0;
              const pb = b.popularity ?? b.vote_count ?? 0;
              return pb - pa;
            });
          } else if (sortBy === 'rating') {
            arr = [...arr].sort((a, b) => (b.rating ?? 0) - (a.rating ?? 0));
          } else if (sortBy === 'year') {
            arr = [...arr].sort((a, b) => (b.year ?? 0) - (a.year ?? 0));
          } else if (sortBy === 'az') {
            arr = [...arr].sort((a, b) =>
              (a.name || '').localeCompare(b.name || '')
            );
          }

          return arr;
        }, [items, typeFilter, srcFilter, sortBy, settings.region]);

        const showEmpty = !loading && !loadingMore && !error && filtered.length === 0;
        const isSearching = debSearch.trim().length > 0;

        /* Reset to home */
        const resetToHome = () => {
          setSearch('');
          setDebSearch('');
          setTypeFilter('all');
          setSrcFilter('all');
          setSortBy('popularity');
        };

        return (
          <>
            {/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */}
            <header id="header" ref={headerRef}>
              <div className="header-inner">
                <div className="header-top">
                  {/* Logo ‚Äî clicks reset page */}
                  <div className="logo" onClick={resetToHome} title="Back to home">
                    <span className="logo-dim">FREE</span>
                    <span className="logo-white">FLIX</span>
                  </div>

                  {/* Search ‚Äî shorter */}
                  <div className="search-wrap">
                    <input
                      className="search-input"
                      type="text"
                      placeholder="Search titles‚Ä¶"
                      value={search}
                      onChange={e => setSearch(e.target.value)}
                      autoComplete="off"
                      spellCheck="false"
                    />
                    <svg className="search-icon" width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                  </div>

                  {/* Search result count ‚Äî only when searching */}
                  {isSearching && !loading && (
                    <span className="search-count">{filtered.length} result{filtered.length !== 1 ? 's' : ''}</span>
                  )}

                  <div className="header-actions">
                    {/* Roulette */}
                    <button
                      className="roulette-btn"
                      onClick={() => setShowRoulette(true)}
                      title="Random pick"
                    >
                      <span>üé≤</span>
                      <span>Surprise Me</span>
                    </button>

                    {/* Settings */}
                    <button
                      className={`icon-btn ${showSettings ? 'active' : ''}`}
                      onClick={() => setShowSettings(v => !v)}
                      title="Settings"
                    >
                      <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                        />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                    </button>
                  </div>
                </div>

                {/* Filter bar */}
                <div className="filter-bar">
                  {[
                    { v: 'all',    l: 'All' },
                    { v: 'movie',  l: 'üé¨ Movies' },
                    { v: 'series', l: 'üì∫ Series' },
                  ].map(({ v, l }) => (
                    <button key={v} className={`fbtn ${typeFilter === v ? 'on' : ''}`} onClick={() => setTypeFilter(v)}>{l}</button>
                  ))}

                  {sources.length > 0 && (
                    <>
                      <div className="fsep" />
                      <button className={`fbtn ${srcFilter === 'all' ? 'on' : ''}`} onClick={() => setSrcFilter('all')}>
                        All Sources
                      </button>
                      {sources.map(s => (
                        <button key={s} className={`fbtn ${srcFilter === s ? 'on' : ''}`} onClick={() => setSrcFilter(s)}>{s}</button>
                      ))}
                    </>
                  )}

                  {/* Sort ‚Äî pushed to right */}
                  <div className="sort-label" style={{marginLeft:'auto'}}>
                    Sort
                    <select className="sort-select" value={sortBy} onChange={e => setSortBy(e.target.value)}>
                      <option value="popularity">Popularity</option>
                      <option value="rating">Rating</option>
                      <option value="year">Newest</option>
                      <option value="az">A‚ÄìZ</option>
                    </select>
                  </div>
                </div>
              </div>
            </header>

            {/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */}
            <main id="main" style={{ paddingTop: headerH + 16 }}>

              {loading && <Skeletons n={PER_PAGE} />}

              {error && (
                <div className="err-box">
                  <svg width="15" height="15" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                  </svg>
                  {error}
                </div>
              )}

              {!loading && !error && filtered.length > 0 && (
                <div className="grid">
                  {filtered.map((item, i) => {
                    const key = item.id ?? `${item.name}||${item.type}`;
                    return (
                      <Card
                        key={key}
                        item={item}
                        index={i}
                        onClick={() => setSelected(item)}
                        cardRef={i === filtered.length - 1 ? lastCardRef : null}
                      />
                    );
                  })}
                </div>
              )}

              {showEmpty && (
                <div className="state-box">
                  <div className="state-icon">üîç</div>
                  <div className="state-title">No results found</div>
                  <div className="state-sub">Try a different search or clear your filters</div>
                </div>
              )}

              {loadingMore && (
                <div className="load-row"><div className="spin" /></div>
              )}

              {!loading && !loadingMore && !hasMore && filtered.length > 0 && (
                <div className="end-line">You've seen it all üé¨</div>
              )}
            </main>

            {/* Modal */}
            {selected && (
              <Modal
                item={selected}
                onClose={() => setSelected(null)}
                profanityFilter={settings.profanityFilter}
              />
            )}

            {/* Settings */}
            {showSettings && (
              <SettingsPanel
                settings={settings}
                onChange={updateSetting}
                onClose={() => setShowSettings(false)}
              />
            )}

            {/* Roulette */}
            {showRoulette && items.length > 0 && (
              <RouletteOverlay
                items={filtered.length > 0 ? filtered : items}
                onOpen={setSelected}
                onClose={() => setShowRoulette(false)}
              />
            )}
          </>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<FreeFlix />);
    </script>
  </body>
</html>